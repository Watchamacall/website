<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--Font-->
  <link rel="stylesheet" href="MindSlayer_files/font-awesome.min.css">

  <!--Bootstrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <!---Prism---->
  <script src="JavaScript/prism.js"></script>
  <link rel="stylesheet" href="CSS/prism.css">
  <!--Custom-->
  <link rel="stylesheet" href="CSS/stylesheet.css">
  <script src="JavaScript/scripts.js"></script>
  <link href="MindSlayer_files/css.css" rel="stylesheet">
  <link href="CSS/ProjectStylesheet.css" rel="stylesheet">

</head>

<body data-new-gr-c-s-check-loaded="8.904.0" data-gr-ext-installed="">
  <div class="topnav" id="myTopnav">
    <a href="./index.html">Home</a>
    <a href="MindSlayer.html" >MindSlayer</a>
    <a href="SFAS2023.html">Hole In The Wall</a>
    <a href="#" class="active">Dream Collection</a>
    <a href="#about">Resume</a>
    <a href="javascript:void(0);" class="icon" onclick="NavbarOpen()">
      <i class="fa fa-bars"></i>
    </a>
  </div>
  <!--Carousel-->
  <div class="container">
    <br>
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        <li data-target="#myCarousel" data-slide-to="3"></li>
      </ol>

      <!-- Wrapper for slides -->
      <div class="carousel-inner" role="listbox">

        <div class="item active">
          <video autoplay loop>
            <source src="images/DreamCollection/AI_Chase_Player.mp4" type="video/mp4">
          </video>
          <div class="carousel-caption">
            <h3>AI Chasing Player</h3>
            <p>AI chasing the other player in the game</p>
          </div>
        </div>

        <div class="item">
          <video autoplay loop>
            <source src="images/DreamCollection/Player_Movement.mp4" type="video/mp4">
          </video>
          <div class="carousel-caption">
            <h3>Player Moving</h3>
            <p>Other player moving in the game</p>
          </div>
        </div>
        <!-- <div class="item">
                  <img src="./Images/MindSlayer/MindSlayerImage.png" alt="Chania" width="460" height="345">
                  <div class="carousel-caption">
                    <h3>Chania</h3>
                    <p>The atmosphere in Chania has a touch of Florence and Venice.</p>
                  </div>
                </div>
              
                <div class="item">
                  <img src="./Images/MindSlayer/MindSlayerImage.png" alt="Flower" width="460" height="345">
                  <div class="carousel-caption">
                    <h3>Flowers</h3>
                    <p>Beautiful flowers in Kolymbari, Crete.</p>
                  </div>
                </div>
          
                <div class="item">
                  <img src="./Images/MindSlayer/MindSlayerImage.png" alt="Flower" width="460" height="345">
                  <div class="carousel-caption">
                    <h3>Flowers</h3>
                    <p>Beautiful flowers in Kolymbari, Crete.</p>
                  </div>
                </div> -->

      </div>

      <!-- Left and right controls -->
      <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>

  <div class="projectDiv">
    <h1>Dream Collection</h1>
    <p>
      Dream collection is a co-op third person game where players have to collect Dreams and avoid Nightmares to gain the highest score possible. This was created as part of the Networking Module for Year 2 of University
      <br>This project uses <a href=#>Forge Networking Remastered</a> as the networking middle-ware for the backend implementation.
    </p>
  </div>
  <h3>Networking</h3>
  <div class="sidebyside">
    <div class="sidebysideElement">
      <h3>Network Setup</h3>
      <p>
        The networking runs on a Client Server environment with a Client being the Server as well, all AI and Objects are changed on the Server side and send out position and rotation to all Clients. An example of this in code is below
      </p>
      <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
private void Update()
{
  if (networkObject.IsServer) //Only turning on the Server, keeps the rotation the same
  {
    transform.rotation *= Quaternion.AngleAxis(rotationSpeed * Time.deltaTime, Vector3.up); //Update Speed
    networkObject.rotation = transform.rotation;
  }
  else
  {
    transform.rotation = networkObject.rotation;
  }
}
      </code>
    </div>

    <div class="sidebysideElement">
      <h3>Client Movement</h3>
      <p>
        The movement of the Clients are done on their side and their positions and rotations are sent out to the other Clients. How this is done is below
      </p>
      <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
public void LateUpdate()
{
  if (networkObject != null)
  {
    if (networkObject.IsOwner) //Sending information about Owner to other Client's
    {
      networkObject.position = transform.position;
      networkObject.rotation = transform.rotation;
    }
    else //Recieving data from Owner about this Client
    {
      transform.position = networkObject.position;
      transform.rotation = networkObject.rotation;
    }
  }
}
      </code>
    </div>
  </div>

  <div class="sidebyside">
    <div class="sidebysideElement">
      <h3>Remote Procedure Call</h3>
      <p>
        RPCs are used to send information to various params such as, All Clients and Server Only. An example of this being used within DreamObjectBase can be seen below
      </p>
      <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
/// &#60;summary&#62;
/// When an Owner steps into the trigger, send RPC
/// &#60;/summary&#62;
/// &#60;param name="collider"&#62;The Owner which has stepped into it&#60;/param&#62;
private void OnTriggerEnter(Collider collider)
{
  if (collider.CompareTag(playerTag))
  {
    networkObject.SendRpc(RPC_PLAYER_HIT, Receivers.Server);
  }
}
/// &#60;summary&#62;
/// RPC call to start the spinup process of the Object
/// &#60;/summary&#62;
/// &#60;param name="args"&#62;N/A&#60;/param&#62;
public override void PlayerHit(RpcArgs args)
{
  if (networkObject.IsServer) //Only the server will activate the Coroutine, keeps everybody on the same rotation
  {
    StartCoroutine(SpinUp());
  }
}      
      </code>
    </div>
    <div class="sidebysideElement">
      <h3>Client Score</h3>
      <p>
        The Client’s score is kept in an Instance called “Score” and is accessed by DreamObjectBase when needing to update the score. The code below shows the RPC call for updating the score
      </p>
      <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
/// &#60;summary&#62;
/// RPC call for updating the Client on the current score
/// &#60;/summary&#62;
/// &#60;param name="args"&#62;N/A&#60;/param&#62;
public override void NewScore(RpcArgs args)
{
  localScore = networkObject.Score;
}
      </code>
    </div>
  </div>

  <div id="playerMovement"class="projectDiv">
    <h2>Client Movement</h2>
    <p>
      The player movement is a Third Person Controller using <a href=#>Cinemachine</a> for the Camera Controller. The code below is the logic used for moving the Client
    </p>

    <code data-prismjs-copy="Copy this code snippet" class="language-csharp">  
private void Update()
{
    Vector3 cameraForwardDirection = Vector3.ProjectOnPlane(Camera.main.transform.forward, Vector3.up); //Get's the Camera's forward Vector in the world

    Quaternion rotationToCamera = Quaternion.LookRotation(cameraForwardDirection, Vector3.up); //Turn to Quaternion

    Vector3 directionToMoveTowards = rotationToCamera * movementDirection; //Get the direction we want to move towards in Vector3

    if (movementDirection != Vector3.zero) //Only set's rotation if moving, stops player turning constantly
    {
        playerRotation = Quaternion.LookRotation(directionToMoveTowards, Vector3.up); //Get the rotation the player should meet
    }

    Vector3 finalDirection = new Vector3();

    switch (currentState) //Different finalDirection setups for eithr Ground or Flying.
    {
        case EMovementModes.Ground:

            finalDirection = new Vector3
            (
                directionToMoveTowards.x * moveSpeedAcceleration,
                directionToMoveTowards.y,
                directionToMoveTowards.z * moveSpeedAcceleration
            );
            //Rotate only on Y axis when Ground, stops Diagonal/Upright player rotation
            playerRotation.x = 0;
            playerRotation.z = 0;

            break;
        case EMovementModes.Flying:

            finalDirection = new Vector3
            (
                directionToMoveTowards.x * moveSpeedAcceleration,
                directionToMoveTowards.y * altitudeChangeSpeed,
                directionToMoveTowards.z * moveSpeedAcceleration
            );

            break;

        default:
            break;
    }

    //Player would look diagonal until moving again if this isn't here
    if (movementDirection == Vector3.zero)
    {
        playerRotation.x = 0;
        playerRotation.z = 0;
    }

    transform.rotation = Quaternion.Lerp(transform.rotation, playerRotation, rotationSpeed); //Lerp towards camera forward

    transform.position += finalDirection * Time.deltaTime; //Move Player in finalDirection based on deltaTime
}
    </code>
  </div>

  <div id="playerMovement"class="projectDiv">
    <h2>UI Manager</h2>
    <p>
      The Client’s UI Manager uses Enums and Structs to setup the UI. The code below shows the setup
    </p>

    <code data-prismjs-copy="Copy this code snippet" class="language-csharp">  
//Enum for elements in the UI, match them to the number of elements you will have in the array
public enum EUIUnique
{
    CANVAS_Main,
    CANVAS_Pause,
    CANVAS_Options,
    CANVAS_Dead,
}

[System.Serializable]
public struct FUIElement
{
    public Canvas canvas;
    public bool pauseWorld;
    public EUIUnique ui_Enum;
}
    </code>
  </div>

  <div id="playerMovement"class="projectDiv">
    <h2>Behaviour Trees</h2>
    <p>
      The AI in this project use Behaviour Trees (BT) for their functionality. The code below is the creation of the Behaviour Tree alongside an image of what this is like in visual form.
    </p>
<div class="sidebyside">
  <div class="sidebysideElement">
    <code data-prismjs-copy="Copy this code snippet" class="language-csharp">  
/// &#60;summary&#62;
/// Set's up the BT for the AI
/// &#60;/summary&#62;
private void Start()
{
    blackboard = new BT_Blackboard(transform, playerTag);
    /*
      * Organised into Regions for ease of viewing
      */
    #region Damage Player Sequence
    IsPlayerClose damageCloseCheck = new IsPlayerClose(damageRange);

    #region Set Player Damage Selector
    IsPlayerAssigned damagePlayerAssigned = new IsPlayerAssigned();
    
    SetPlayer setPlayerDamage = new SetPlayer();

    Selector setPlayerDamageSelector = new Selector(new List&#60;Node&#62; { damagePlayerAssigned, setPlayerDamage });
    #endregion

    DamageClosestPlayer damageClosestPlayer = new DamageClosestPlayer(damageToDo);

    Sequence damagePlayerSequence = new Sequence(new List&#60;Node&#62; { damageCloseCheck, setPlayerDamageSelector, damageClosestPlayer });
    #endregion

    #region Chase Player Sequence
    IsPlayerClose chaseCloseCheck = new IsPlayerClose(chaseRange);
    #region Set Player Selector
    IsPlayerAssigned setPlayerAssigned = new IsPlayerAssigned();

    SetPlayer setPlayer = new SetPlayer();

    Selector setPlayerSelector = new Selector(new List&#60;Node&#62; { setPlayerAssigned, setPlayer });
    #endregion
    ChaseClosePlayer chaseClosePlayer = new ChaseClosePlayer(moveSpeed);

    Sequence chasePlayerSequence = new Sequence(new List&#60;Node&#62; { chaseCloseCheck, setPlayerSelector, chaseClosePlayer });
    #endregion

    #region Vibe Sequence
    #region Unset Player Selector
    #region Unset Player Assigned Inverter
    IsPlayerAssigned unsetPlayerAssigned = new IsPlayerAssigned();

    Inverter unsetPlayerAssignedInverter = new Inverter(unsetPlayerAssigned);
    #endregion
    SetPlayer unsetPlayer = new SetPlayer(false);

    Selector unsetPlayerSelector = new Selector(new List&#60;Node&#62; { unsetPlayerAssignedInverter, unsetPlayer });
    #endregion
    Sequence vibeSequence = new Sequence(new List&#60;Node&#62; { unsetPlayerSelector });
    #endregion
    #region Root Selector
    root = new Selector(new List&#60;Node&#62; { damagePlayerSequence, chasePlayerSequence, vibeSequence });
    #endregion
}
    </code>
  </div>
  <div class="sidebysideElement">
    <img src="Images/DreamCollection/BT_Nightmare.png">
  </div>
  </div>
</div>

<p>
  The code snippets below show the Nodes which have been used in the above assignment  
</p>
<!--Behaviour Tree Nodes-->
<div class="sidebyside">
  
  <div class="sidebysideElement">
    <h3>ChaseClosePlayer</h3>
    <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
public class ChaseClosePlayer : Node
{
    /*
      * Return RUNNING if it's possible to move towards target, FAILURE if not
      */
    protected float moveSpeed;
    
    /// &#60;summary&#62;
    /// Constructor for ChaseClosePlayer
    /// &#60;/summary&#62;
    /// &#60;param name="moveSpeed"&#62;The speed the GameObject will move at&#60;/param&#62;
    public ChaseClosePlayer(float moveSpeed)
    {
        this.moveSpeed = moveSpeed;
    }

    /// &#60;summary&#62;
    /// Evaluation for this Node
    /// &#60;/summary&#62;
    /// &#60;param name="blackboard"&#62;The BT_Blackboard the parent Node uses&#60;/param&#62;
    /// &#60;returns&#62;RUNNING whilst moving towards the Target Var and looking at Target&#60;/returns&#62;
    public override NodeState Evaluate(BT_Blackboard blackboard)
    {
        blackboard.Origin.position = Vector3.MoveTowards(blackboard.Origin.position, blackboard.Target.position, moveSpeed * Time.deltaTime);
        blackboard.Origin.LookAt(blackboard.Target, Vector3.up);
        return NodeState.RUNNING;
    }
}
    </code>
  </div>
  <div class="sidebysideElement">
    <h3>DamageClosestPlayer</h3>
    <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
public class DamageClosestPlayer : Node
{
    /*
      * One of the nodes in the Nightmare's BT
      * Returns SUCCESS when damaging the Blackboard's Target
      */
    float damageToDo;

    /// &#60;summary&#62;
    /// Constructor for DamageClosestPlayer    
    /// &#60;/summary&#62;
    /// &#60;param name="damageToDo"&#62;The damage the AI will do&#60;/param&#62;
    public DamageClosestPlayer(float damageToDo)
    {
        this.damageToDo = damageToDo;
    }

    /// &#60;summary&#62;
    /// Evaluation of this Node
    /// &#60;/summary&#62;
    /// &#60;param name="blackboard"&#62;The BT_Blackboard the parent Node uses&#60;/param&#62;
    /// &#60;returns&#62;SUCCESS when damaging Target Var&#60;/returns&#62;
    public override NodeState Evaluate(BT_Blackboard blackboard)
    {
        blackboard.Target.GetComponent<Health>().SetHealth(damageToDo * Time.deltaTime);
        return NodeState.SUCCESS;
    }
}
    </code>
  </div>
</div>

  <div class="sidebyside">
    
    <div class="sidebysideElement">
      <h3>IsPlayerAssigned</h3>
      <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
public class IsPlayerAssigned : Node
{
    /*
      * Return Failure if player is not assigned, SUCCESS if assigned
      */

    /// &#60;summary&#62;
    /// Evaluation of this Node    
    /// &#60;/summary&#62;
    /// &#60;param name="blackboard"&#62;The BT_Blackboard the parent Node uses&#60;/param&#62;
    /// &#60;returns&#62;FAILURE if Target is not assigned, SUCCESS if Target is&#60;/returns&#62;
    public override NodeState Evaluate(BT_Blackboard blackboard)
    {
        return blackboard.Target == null ? NodeState.FAILURE : NodeState.SUCCESS;
    }
}
      </code>
    </div>
    <div class="sidebysideElement">
      <h3>IsPlayerClose</h3>
      <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
public class IsPlayerClose : Node
{
    /*
      * Node in the Nightmare's BT
      * Returns SUCCESS if target is within maxThreshold of origin, FAILURE if not
      */
    protected float maxThreshold;

    /// &#60;summary&#62;
    /// Constructor for IsPlayerClose
    /// &#60;/summary&#62;
    /// &#60;param name="maxThreshold">The max distance the AI will look at&#60;/param&#62;
    public IsPlayerClose(float maxThreshold)
    {
        this.maxThreshold = maxThreshold;
    }

    /// &#60;summary&#62;
    /// Evaluation of this Node
    /// &#60;summary&#62;    
    /// &#60;param name="blackboard"&#62;The BT_Blackboard the parent Node uses&#60;/param&#62;
    /// &#60;returns&#62;SUCCESS if one or more player's are in radius, FAILURE if not&#60;/returns&#62;
    public override NodeState Evaluate(BT_Blackboard blackboard)
    {
        RaycastHit[] hits = Physics.SphereCastAll(blackboard.Origin.position, maxThreshold, Vector3.one);

        if (hits.Length &#62; 0)
        {
            //Getting each RaycastHit that has the playerTag on it
            List&#60;RaycastHit&#62; playersHits = hits.Where(hit =&#62; hit.collider.CompareTag(blackboard.PlayerTag)).ToList();
            if (playersHits.Count &#62; 0)
            {
                blackboard.RaycastHits = playersHits.ToArray();
                return NodeState.SUCCESS;       
            }
        }
        return NodeState.FAILURE;
    }
}
      </code>
    </div>
  </div>
  <div id="playerMovement"class="projectDiv">
    <h2>SetPlayer</h2>
    <code data-prismjs-copy="Copy this code snippet" class="language-csharp">
public class SetPlayer : Node
{
    /*
      * Return SUCCESS if the player has been set, FAILURE otherwise. Implement bool for set or unset, saves using same thing but changing it a little (if (bool) {SetPlayer} else {UnsetPlayer})
      */

    protected bool setPlayer;
    /// &#60;summary&#62;
    /// Constructor for SetPlayer
    /// &#60;summary&#62;
    /// &#60;param name="setPlayer"&#62;Whether to set or unset the Target BT_Blackboard variable&#60;/param&#62;
    public SetPlayer(bool setPlayer = true)
    {
        this.setPlayer = setPlayer;
    }

    /// &#60;summary&#62;
    /// Evaluation of this node
    /// &#60;summary&#62;
    /// &#60;param name="blackboard"&#62;The BT_Blackboard the parent Node uses&#60;/param&#62;
    /// &#60;returns&#62;SUCCESS no matter if it Sets or UnSets the Target Var&#60;/returns&#62;
    public override NodeState Evaluate(BT_Blackboard blackboard)
    {
        Transform closestPlayer = blackboard.RaycastHits[0].collider.GetComponent&#60;Transform&#62;();

        if (setPlayer)
        {
            //Casting these to Transform
            List/// &#60;Transform&#62; players = new List&#60;Transform&#62;();
            blackboard.RaycastHits.ToList().ForEach(hit =&#62; players.Add(hit.collider.GetComponent&#60;Transform&#62;()));

            for (int i = 1; i &#60; players.Count; i++)
            {
                //If new player is closer than closestPlayer
                if (Vector3.Distance(blackboard.Origin.position, players[i].position) &#60; Vector3.Distance(blackboard.Origin.position, closestPlayer.position))
                {
                    closestPlayer = players[i];
                }
            }
        }

        blackboard.Target = setPlayer ? closestPlayer : null;
        return NodeState.SUCCESS;
    }
}
    </code>
  </div>
  <div class="footer">

    <a href="https://www.vecteezy.com/free-vector/facebook"
        style="text-align: right;margin: auto;margin-right: 0;text-decoration: none;color: #ccc;">Facebook Vectors
        by Vecteezy</a>
</div>
</body>

</html>